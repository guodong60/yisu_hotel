# 🏨 易宿 (Yisu) - 全栈酒店预订与管理平台

易宿是一个现代化的全栈酒店预订系统，采用前后端分离架构，包含**移动端（C端用户）**、**商户管理端（B端商户）**和**系统后台（管理）**三个核心端点。系统实现了从商户入驻、客房管理、移动端动态下单到平台审核的完整业务闭环。

## 🛠 技术栈

* **服务端 (Backend)**: Node.js + Express + Mongoose (MongoDB) + JWT + Bcryptjs
* **管理后台 (Admin Web)**: React + Ant Design + Vite + React Router
* **移动端 (Mobile H5)**: React + Taro 跨端框架
* **基础设施**: 独立图片上传服务 (Multer)、本地持久化存储、Token 鉴权机制

---

## ✨ 核心功能模块

### 📱 移动端 (面向真实用户 - Taro H5)
* **用户认证体系**: 支持 11 位中国大陆手机号强校验注册与登录，Token 自动无感携带。
* **动态展示与检索**: 酒店列表支持中文 URL 解码模糊搜索，动态聚合计算并展示旗下房型“最低价”。
* **智能日历组件**: 自动计算入住晚数，具备防呆拦截（防离店日期早于入住日期），日期跨度自动联动。
* **一键预订闭环**: 动态关联房型信息与个人信息，支持防刷单（防重复提交）机制。
* **个人中心**: 原生 TabBar 导航，支持订单状态实时追踪（待审核/已确认/已拒绝）与软删除清理。

### 💼 商户端 (面向酒店老板 - React Web)
* **酒店录入与维护**: 支持图文上传（Multer）、星级、地理位置等信息录入。
* **修改重审机制**: 酒店信息一旦修改，强制重置为“审核中”，下线房型管理权限，保障平台数据合规。
* **房型与价格管理**: 针对已审核通过的酒店，动态增删改查房型与价格。
* **真实订单看板**: 实时接收移动端订单，支持接单（已确认）、拒单以及清洗历史作废订单。
* **下架申请**: 商户无法恶意删库，需发起“软删除申请”交由总后台审核。

### 👑 总管理端 (面向平台运营 - React Web)
* **严格权限隔离**: 拦截越权访问，严禁通过公开接口注册管理员，支持内部独立分配高管账号。
* **酒店审核状态机**: 支持审核通过、填写详细驳回原因、强制上下线。
* **退市审批**: 审批商户的删除申请，执行对 C 端用户的“隐形软删除”。
* **全域用户管理**: 打通 `User` (B端/运营) 和 `Member` (C端) 两张表，实现多端角色统一监控与封号管理（Root 账号防误删保护）。

---

## 🚀 架构创新与技术亮点 (Innovations)

1. **企业级状态机与工作流闭环 (State Machine)**
   彻底告别“一键删除”的危险操作。设计了严谨的生命周期：`审核中 -> 不通过/通过 -> 待删除 -> 已删除(软删除)`。通过状态锁定权限（如：待删除状态下禁止修改信息），保障了多角色协作的安全性。
2. **防越权与密码加密防御 (Security)**
   * **输入层**：Bcrypt.js 单向散列加密，拒绝明文密码脱库风险。
   * **接口层**：JWT 拦截器根据 Role 字段进行 `AuthGuard` 守卫，后端强制覆写越权注册的 Role 字段，彻底封死提权漏洞。
   * **前端层**：针对同域 LocalStorage 碰撞问题，实现了完美的隔离登出处理。
3. **Mongoose 聚合运算与动态价格 (Data Aggregation)**
   在不增加冗余字段的前提下，利用 `.lean()` 和 `Promise.all` 在服务端并行遍历酒店的子房型，动态计算最低起步价（Min Price）推送到移动端，保证了价格的绝对实时性。
4. **前端防抖与后端防刷单联动 (Anti-Spam)**
   移动端采用 `mask` 全屏遮罩防止连点，服务端根据 `memberId + hotelName + roomName + 状态(待审核)` 联合查库，精准拦截重复产生的并发脏订单。
5. **RESTful 规范与异常边界捕获**
   全栈严格遵守 RESTful API 动作规范。利用统一的 `Response Wrapper` 返回标准结构体。并在可能导致 Node.js 进程崩溃的边界点（如 Token 解析失败、并发抢占）加装了健壮的 `try...catch` 保护伞。

---

## 💻 快速本地运行指南

本系统包含三个独立的子工程，请确保您的计算机已安装 **Node.js** 和 **MongoDB**。

### 1. 启动服务端 (yisu-server)
> 提供核心 API 及图片静态托管服务
```bash
cd server
npm install
# 请确保本地 MongoDB 服务已启动 (默认连接 mongodb://127.0.0.1:27017)
npm run dev
# 看到 "🚀 服务端已启动: http://localhost:3000" 即代表成功
```
### 2. 启动管理后台 (yisu-admin)
> 平台运营与商户管理入口
```bash
cd admin
npm install
npm run dev
# 默认运行在 http://localhost:5173
# 测试超管账号: admin / 123456 (注：测试前请确保已在服务端注册并经过 bcrypt 加密)
# 商户账号: 可在登录页自由注册
```

### 3. 启动移动端 (yisu-mobile)
> 面向真实消费者的预订 H5
```bash
cd yisu-mobile
npm install
npm run dev:h5
# 默认运行在 http://localhost:10086
#可在浏览器控制台开启“移动端设备模拟”以获得最佳预览体验。
```
